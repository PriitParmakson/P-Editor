<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duplikaatide kontroll</title>

    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery.min.js"></script>

    <!-- Material Design icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"
      crossorigin="anonymous">
    <!-- Tether on vaja tooltip-de jaoks -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" crossorigin="anonymous"></script>

    <!-- Stiilid -->
    <link rel='stylesheet' href='css/Samas.css'>
    <style></style>

    <script src='js/Targifunktsioonid.js'></script>
    <script src='js/SamatekstiPrimitiivid.js'></script>
    <!-- script src=''></script -->

    <script>
      function alusta() {
        /*
          Laeb Google töölehelt "Samatekstid" kõik tekstid, leiab ja kuvab tekstid, mille kanoonilised kujud ühtivad, s.t tekstid, mis langevad täht-tähelt kokku või erinevad ainult kirjavahemärkide poolest. 
        */
        var url = 'https://script.google.com/macros/s/AKfycbzjP4j2ZDOl4MQmcZxqDSimA59pg9yGNkpt2mQKRxUfN3GzuaU/exec';
        $.get(url,
          function (data, status, xhr) {
            var tekstid = data.Tekstid;
            var kH = new Set(); // Kanoonilised kujud hulgana
            var duplikaatkujud = [];
            var kM = []; // Kanoonilised kujud massiivina
            tekstid.forEach((t, i) => {
              var k1 = kanoonilineKuju(t.Tekst);
              var p1 = k1.substr(0, Math.floor(k1.length / 2))
              kM[i] = k1;
              if (kH.has(k1)) {
                duplikaatkujud.push(k1);
              } else {
                kH.add(k1);
              }
            });
            // Kuva sama kanoonilise kujuga tekstid
            duplikaatkujud.forEach((d) => {
              $('<p></p>')
                .html('&nbsp;')
                .appendTo('#Tulemus');
              // Leia ja kuva kanoonilise kujuga d tekstid  
              tekstid.forEach((t, i) => {
                if (kM[i] == d) {
                  $('<li></li>')
                    .text(t.Tekst)
                    .appendTo('#Tulemus');
                }
              });
            });
            $('<p></p>')
              .text('Töödeldud ' + tekstid.length + ' teksti.')
              .appendTo('#Tulemus');
          }
        );
      }

    </script>

  </head>

  <body onload="alusta()">
    <div class='container-fluid'>
      <div class='row'>
        <div class='col-xs-12 col-sm-10 col-md-8 col-lg-8 col-xl-6'>

          <div id='Tulemus'>
            <h1>Duplikaadid</h1>

          </div>

        </div>
      </div>
  </body>

</html>