<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Funktsioonikataloog</title>

  <!-- JQuery -->
  <script src="https://code.jquery.com/jquery.min.js"></script>

  <!-- Material Design icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"
    crossorigin="anonymous">
  <!-- Tether on vaja tooltip-de jaoks -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" crossorigin="anonymous"></script>

  <!-- Stiilid -->
  <link rel='stylesheet' href='../css/Samas.css'>

  <style>
    .failinimiFkataloogis { margin: 1rem 0 0 0; }
    .funktsioonFkataloogis { margin: 0 0 0 1rem; color: IndianRed; background-color: lightcyan; font-family: 'Inconsolata'; }
    .kommentaarFkataloogis { margin-left: 2rem; font-size: 10pt; }
  </style>

  <!-- Skriptid -->
  <script>

  function alusta() {

    var faile = 0;
    var funktsioonikirjeldused = [];

    var u = 'https://api.github.com/repos/PriitParmakson/Samatekst/contents/js';
    $.getJSON(u, function(jsFailid) {
      faile =jsFailid.length;
      jsFailid.forEach(function(fail) {
        var d = fail.download_url;
        var failiNimi = fail.name;
        $.get(d, function(failiSisu) {
          // var funktsiooneOtsivRegex = /function\s+(\S.+\(.*\))[\s\S]*?\/\*([\s\S]*?)\*\//g;
          var funktsiooneOtsivRegex = /function\s+(\S+?)\(/g;
          // \/\*[\s\S]*?\*\/
          var match;

          do {
            match = funktsiooneOtsivRegex.exec(failiSisu);
            if (match) {
              funktsioonikirjeldused.push(
                {
                  nimi: match[1],
                  fail: failiNimi
                  // ,
                  // kommentaar: match[2]
                 });
            }
          } while (match);
          
        });
      });
    });

    $('<p></p')
      .text(faile.toString() + ' failist leitud ' + funktsioonikirjeldused.length.toString() + ' funktsiooni')
      .appendTo('#Tulemus');

    // Sorteeri funktsioonikirjeldused
    // Vt: https://stackoverflow.com/questions/1129216/sort-array-of-objects-by-string-property-value-in-javascript 

    function compare(a,b) {
      if (a.nimi < b.nimi)
        return -1;
      if (a.nimi > b.nimi)
        return 1;
      return 0;
    }

    funktsioonikirjeldused.sort(compare);

    // Kuva kataloog
    funktsioonikirjeldused.forEach(function(funktsioonikirjeldus) {
      var fnKirje = $('<p></p>')
        .addClass('funktsioonFkataloogis')
        .text(funktsioonikirjeldus.nimi)
        .appendTo('#Tulemus');
      /*
      var kommentaariread = funktsioonikirjeldus.kommentaar.split(/\n/g);
      var kk = '';
      kommentaariread.forEach(function(r) {
        kk += r + '<br>';
      });  
      $('<p></p>')
        .addClass('kommentaarFkataloogis')
        .html(kk)
        .appendTo('#Tulemus');
      */
    });

  }

  </script>

</head>

<body onload='alusta()'>
  <div class='container-fluid'>
    <div class='row'>
      <div class='col-xs-12 col-sm-10 col-md-8 col-lg-8 col-xl-6'>

        <h1>Funktsioonikataloog</h1>

        <div id='Tulemus'>
        </div>

      </div>
    </div>
  </div>

</body>

</html>